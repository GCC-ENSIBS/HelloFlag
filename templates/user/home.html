{% extends "../main.html" %}

{% block title %}{{ _("Home") }}{% end %}

{% block header %}
{% from models.Category import Category %}
<script>
    var categories = '{{ Category.list() }}'.replaceAll('&quot;','"');
</script>
<script src="/static/js/libs/highcharts-all.js"></script>
<script src="/static/js/libs/highcharts-more.js"></script>
<script src="/static/js/pages/missions/view.js"></script>
<script src="/static/js/pages/user/home.js"></script>
<link href="/static/css/pages/user/home.css" rel="stylesheet" />
{% end %}

{% block content %}
{% from models.GameLevel import GameLevel %}

{% from models.Hint import Hint %}
{% from tornado.options import options %}
{% set team = user.team %}
<div class="row-fluid">
    <div class="span6">
        <div class="row">
            <div class="span11 offset1 well">
                <h2 style="padding-bottom: 8px;">
                    <i class="fa fa-user"></i> {{ user.handle }}
                </h2>
                <span style="float: right; margin-top: -63px; text-align: center;">
                    <table>
                        <tr>
                            {% if options.teams %}<td>{{ _("Team Score") }}</td>{% end %}{% if scoreboard_visible %}<td style="padding-left: 20px;">Rank</td>{% end %}
                        </tr>
                        <tr>
                            {% if options.teams %}<td><h4 style="margin-top: 0;">{% if options.banking %}${% end %}{{ team.money }} &bull; {{ len(team.flags) }} <i class="fa fa-flag-o"></i><h4></td>{% end %}{% if scoreboard_visible %}<td style="padding-left: 20px;"><h4 style="margin-top: 0;">{{ rank }}<h4></td>{% end %}
                        </tr>
                    </table>
                </span>
                <center>
                    {% if options.teams or not team %}
                        <img src="/avatars/{{ user.avatar }}" class="img-polaroid" />
                    {% else %}
                        <img src="/avatars/{{ team.avatar }}" class="img-polaroid" />
                    {% end %}
                </center>
                <hr>
                {% if team is not None %}
                    {% set hintcount = len(Hint.all()) %}
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th><h5 style="display: inline;">{% if options.teams %}{{ _("Team") }}{% else %}{{ _("Player") }}{% end %}</h5></th>
                                <th style="text-align: center;"><h5 style="display: inline;">{{ _("Current Level") }}</h5></th>
                                {% if options.use_bots %}
                                    <th style="text-align: center;"><h5 style="display: inline;">{{ _("Active Bots") }}</h5></th>
                                {% end %}
                                {% if hintcount > 0 %}
                                <th style="text-align: center;"><h5 style="display: inline;">{{ _("Hints Taken") }}</h5></th>
                                {% end %}
                                <th style="text-align: center;"><h5 style="display: inline;">{{ _("Flags Captured") }}</h5></th>
                                <th style="text-align: right;"><h5 style="display: inline;">{% if options.banking %}{{ _("Bank Account") }}{% else %}{{ _("Score") }}{% end %}</h5></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{ team.name }}</td>
                                {% if len(team.levels) > 0 %}
                                    <td style="text-align: center;">{{ team.levels[-1].name }}</td>
                                {% else %}
                                    <td style="text-align: center;">0</td>
                                {% end %}
                                {% if options.use_bots %}
                                    <td style="text-align: center;">{{ team.bot_count }}</td>
                                {% end %}
                                {% if hintcount > 0 %}
                                    <td style="text-align: center;">{{ len(team.hints) }}</td>
                                {% end %}
                                <td style="text-align: center;">{{ len(team.flags) }}</td>
                                <td style="text-align: right;">{% if options.banking %}${% end %}{{ team.money }}</td>
                            </tr>
                        </tbody>
                    </table>
                {% else %}
                    <strong>{{ _("You are not on a team") }}</strong>
                {% end %}
            </div>

        </div>
        {% if len(Category.all()) > 2 %}
            <div class="row">
                <!-- Only looks good if there are at least 3 categories -->
                <div class="span11 offset1 well">
                    <h2><i class="fa fa-star"></i> {% if options.teams %}{{ _("Team") }} {% end %}{{ _("Skill Progress") }}</h2>
                    <hr style="margin-bottom: 8px;">
                    <center>
                    {% if game_started %}
                        <div id="spider_skills" style="height:400px; max-width: 550px;" data-uuid="{{ team.uuid }}" data-name="{{ _('Categories') }}">
                            <!-- Spider Chart Here -->
                        </div>
                    {% else %}
                        <div class="row" style="padding-top: 15px;">
                            <div class="span1" style="text-align: right;">
                                <i class="fa fa-pause" style="font-size: 120%;"></i>
                            </div>
                            <div class="span7 msgdescription">
                                    {{ _("Waiting for the game to start...") }}
                            </div>
                        </div>
                    {% end %}
                    </center>
                </div>
            </div>
        {% end %}
    </div>

    {% if options.teams and team and not visitor %}
    <div class="span5 well" style="width: 46%;">
        <h2>
            <i class="fa fa-group"></i>
            {{ _("Team Information") }}
        </h2>
        <hr>
        <h4>{{ _("Team Members") }}</h4>
        <div class="row">
            <div class="container">
                {% for member in team.members %}
                    <div class="span2" align="middle">
                        <a href="/user?id={{member.uuid}}">
                            <h5>{{ member._handle }}</h5>
                        </a>
                        <img src="/avatars/{{ member.avatar }}" class="img-polaroid" align="middle" />
                        <h5>{{ member.money }}</h5>
                    </div>
                {% end %}
            </div>
        </div>
    </div>
    {% end %}


    <div class="span5 well" style="width: 46%;">
        <h2>
            <i class="fa fa-flag"></i>
            {% if options.teams %}{{ _("Team") }} {% end %}{{ _("Mission Progress") }}
        </h2>
        <hr style="margin-bottom: 8px;">
        {% if game_started or not game_started %}
            {% for index, level in enumerate(GameLevel.all()) %}
                {% set show_level = level.type != "hidden" or (level.type == "hidden" and level in team.game_levels) %}
                {% if len(level.unlocked_boxes()) > 0 and team and show_level %}
                    {% if len(GameLevel.all()) > 1 %}
                    <h3 class="levelheader">
                        {% if level.type == 'none' or level in team.game_levels %}
                            <i class="fa fa-unlock-alt"></i>
                        {% else %}
                            <i class="fa fa-lock"></i>
                        {% end %}
                        {{ level.name }}&nbsp;
                    </h3>{% end %}
                    {% if level.description %}<h4 class="levelheader">({{ level.description }})<h4>{% end %}
                    {% if len(team.level_flags(level.number)) != 0 %}
                        <div class="progress" style="height: 8px; margin-bottom: 15px; background-color: #424242;">
                            <div class="bar minibar" style="width: {{ ( len(team.level_flags(level.number)) /  float(len(level.flags)) ) * 100.0 }}%;" title="{{ len(team.level_flags(level.number)) }} / {{ len(level.flags) }}">
                            </div>
                        </div>
                    {% end %}
                    {% if level.type == 'none' or level in team.game_levels %}
                        <hr style="margin: 5px 0;">
                        {% for box in sorted(level.unlocked_boxes()) %}
                            {% if len(box.flags) > 0 %}
                            <div class="row" style="margin-left: 16px;">
                                <div class="span4">
                                    <a href="/user/missions/boxes?uuid={{ box.uuid }}">
                                        <h5 style="display: inline;">
                                            {% if box.operating_system.lower() == "windows" %}
                                            <i class="fa fa-windows"></i>
                                            {% elif box.operating_system.lower() == "linux" %}
                                            <i class="fa fa-linux"></i>
                                            {% elif box.operating_system.lower() == "apple" %}
                                            <i class="fa fa-apple"></i>
                                            {% elif box.operating_system.lower() == "?" %}
                                            <i class="fa fa-desktop"></i>
                                            {% else %}
                                            <i class="fa fa-th"></i>
                                            {% end %} {{ box.corporation.name }} - {{ box.name }}
                                            {% if box._locked %}
                                                <i class="fa fa-lock"></i>
                                            {% else %}
                                                <i class="fa fa-unlock-alt"></i>
                                            {% end %}
                                        </h5>
                                    </a>
                                </div>
                                {% set flagcount=0 %}
                                {% for index, flag in enumerate(sorted(box.flags)) %}
                                    {% if flag in team.flags %}
                                        {% set flagcount += 1 %}
                                    {% end %}
                                {% end %}
                                <div class="span8" style="padding-top: 6px;">
                                    <table style="width: 100%; margin: 0 3px;"><tr>
                                    {% for index, flag in enumerate(sorted(box.flags)) %}
                                        <td style="padding: 0 3px;">
                                            <div class="progress" style="height: 8px; background-color: #424242;" title="{{ flag.name }}">
                                                <div class="bar minibar" style="width: {% if flag in team.flags %}100{% else %}0{% end %}%;"></div>
                                            </div>
                                        </td>
                                    {% end %}
                                    </tr></table>
                                </div>
                            </div>
                            {% end %}
                        {% end %}
                        <br/>
                    {% else %}
                        <hr style="margin: 5px 0;">
                    {% end %}
                {% end %}
            {% end %}
        {% else %}
            <div class="row" style="padding-top: 15px;">
                <div class="span1" style="text-align: right;">
                    <i class="fa fa-pause" style="font-size: 120%;"></i>
                </div>
                <div class="span7 msgdescription">
                        {{ _("Waiting for the game to start...") }}
                </div>
            </div>
        {% end %}
    </div>
        {% if options.teams %}

        <div class="span5 well" style="width: 46%;">
            <h2>
                <i class="fa fa-flag"></i>
                {{ _("Player") }} {{ _("Mission Progress") }}
            </h2>
            <hr style="margin-bottom: 8px;">
            {% if game_started %}
                {% for index, level in enumerate(GameLevel.all()) %}
                    {% set show_level = level.type != "hidden" or (level.type == "hidden" and level in team.game_levels) %}
                    {% if len(level.unlocked_boxes()) > 0 and team and show_level %}
                        {% if len(GameLevel.all()) > 1 %}
                        <h3 class="levelheader">
                            {% if level.type == 'none' or level in team.game_levels %}
                                <i class="fa fa-unlock-alt"></i>
                            {% else %}
                                <i class="fa fa-lock"></i>
                            {% end %}
                            {{ level.name }}&nbsp;
                        </h3>{% end %}
                        {% if level.description %}<h4 class="levelheader">({{ level.description }})<h4>{% end %}
                        {% if len(team.level_flags(level.number)) != 0 %}
                            <div class="progress" style="height: 8px; margin-bottom: 15px; background-color: #424242;">
                                <div class="bar minibar" style="width: {{ ( len(team.level_flags(level.number)) /  float(len(level.flags)) ) * 100.0 }}%;" title="{{ len(team.level_flags(level.number)) }} / {{ len(level.flags) }}">
                                </div>
                            </div>
                        {% end %}
                        {% if level.type == 'none' or level in team.game_levels %}
                            <hr style="margin: 5px 0;">
                            {% for box in sorted(level.unlocked_boxes()) %}
                                {% if not box.locked and len(box.flags) > 0 %}
                                <div class="row" style="margin-left: 16px;">
                                    <div class="span4">
                                        <a href="/user/missions/boxes?uuid={{ box.uuid }}">
                                            <h5 style="display: inline;">
                                                {% if box.operating_system.lower() == "windows" %}
                                                <i class="fa fa-windows"></i>
                                                {% elif box.operating_system.lower() == "linux" %}
                                                <i class="fa fa-linux"></i>
                                                {% elif box.operating_system.lower() == "apple" %}
                                                <i class="fa fa-apple"></i>
                                                {% elif box.operating_system.lower() == "?" %}
                                                <i class="fa fa-desktop"></i>
                                                {% else %}
                                                <i class="fa fa-th"></i>
                                                {% end %} {{ box.corporation.name }} - {{ box.name }}
                                            </h5>
                                        </a>
                                    </div>
                                    {% set flagcount=0 %}
                                    {% for index, flag in enumerate(sorted(box.flags)) %}
                                        {% if flag in user.flags %}
                                            {% set flagcount += 1 %}
                                        {% end %}
                                    {% end %}
                                    <div class="span8" style="padding-top: 6px;">
                                        <table style="width: 100%; margin: 0 3px;"><tr>
                                        {% for index, flag in enumerate(sorted(box.flags)) %}
                                            <td style="padding: 0 3px;">
                                                <div class="progress" style="height: 8px; background-color: #424242;" title="{{ flag.name }}">
                                                    <div class="bar minibar" style="width: {% if flag in user.flags %}100{% else %}0{% end %}%;"></div>
                                                </div>
                                            </td>
                                        {% end %}
                                        </tr></table>
                                    </div>
                                </div>
                                {% end %}
                            {% end %}
                            <br/>
                        {% else %}
                            <hr style="margin: 5px 0;">
                        {% end %}
                    {% end %}
                {% end %}
            {% else %}
                <div class="row" style="padding-top: 15px;">
                    <div class="span1" style="text-align: right;">
                        <i class="fa fa-pause" style="font-size: 120%;"></i>
                    </div>
                    <div class="span7 msgdescription">
                            {{ _("Waiting for the game to start...") }}
                    </div>
                </div>
            {% end %}
        </div>

        {% end %}



</div>
{% end %}
